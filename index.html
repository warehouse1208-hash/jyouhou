<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>全商情報処理検定 小テストジェネレーター</title>
    <style>
        /* --- 画面表示用スタイル --- */
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            line-height: 1.6;
            background-color: #f7f9fc;
            color: #333;
            margin: 0;
            padding: 20px;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
        }
        .container {
            background: #ffffff;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 8px 30px rgba(0,0,0,0.1);
            width: 100%;
            max-width: 700px;
            text-align: center;
        }
        h1 {
            color: #0056b3;
            border-bottom: 2px solid #0056b3;
            padding-bottom: 10px;
            font-size: 1.8em;
            margin-top: 20px;
        }
        #setup, #quiz, #results {
            margin-top: 20px;
        }
        #setup-header {
            margin-bottom: 20px;
        }
        #setup-header h1.school-name {
             font-family: 'Garamond', 'Times New Roman', serif;
             font-size: 2.5em;
             color: #003366; /* 濃紺 */
             margin: 10px 0 5px 0;
             border-bottom: none;
        }
        #setup-header p {
            font-size: 1.1em;
            color: #d9534f;
            font-weight: bold;
            margin-top: 0;
        }
        #question {
            font-size: 1.25em;
            font-weight: bold;
            margin-bottom: 20px;
            text-align: left;
            padding: 15px;
            background-color: #e9f5ff;
            border-left: 5px solid #0056b3;
            border-radius: 5px;
        }
        .btn {
            display: block;
            width: 100%;
            padding: 15px;
            margin: 10px 0;
            border: 1px solid #ccc;
            background-color: #fdfdfd;
            color: #333;
            cursor: pointer;
            font-size: 1em;
            border-radius: 8px;
            transition: all 0.2s ease-in-out;
            text-align: left;
            box-sizing: border-box;
        }
        .btn:hover {
            background-color: #f0f0f0;
            border-color: #0056b3;
            transform: translateY(-2px);
        }
        .btn:active {
            transform: scale(0.98);
        }
        .btn.correct, .btn.incorrect {
            font-weight: bold;
        }
        .btn.correct { background-color: #d4edda; border-color: #c3e6cb; color: #155724; }
        .btn.incorrect { background-color: #f8d7da; border-color: #f5c6cb; color: #721c24; }
        .feedback {
            margin-top: 20px;
            padding: 15px;
            border-radius: 8px;
            text-align: left;
            border: 1px solid #ccc;
        }
        #explanation { background-color: #fff3cd; border-color: #ffeeba; }
        #hint-container { margin: 15px 0; text-align: right; }
        #hint-btn {
            background-color: #17a2b8;
            color: white;
            padding: 8px 15px;
            border-radius: 5px;
            cursor: pointer;
            border: none;
            transition: background-color 0.3s;
        }
        #hint-btn:hover { background-color: #138496; }
        #hint-text {
            display: none;
            margin-top: 10px;
            padding: 10px;
            background-color: #f0f0f0;
            border-radius: 5px;
            text-align: left;
        }
        select, button {
            padding: 12px 15px;
            font-size: 1em;
            margin: 5px;
            border-radius: 8px;
            border: 1px solid #ccc;
        }
        #start-btn, #pdf-btn, #next-btn, #restart-btn {
            color: white;
            cursor: pointer;
            width: 45%; 
            margin-top: 20px;
            border: none;
            transition: background-color 0.3s;
            font-weight: bold;
        }
        #start-btn { background-color: #28a745; }
        #start-btn:hover { background-color: #218838; }
        #pdf-btn { background-color: #d9534f; }
        #pdf-btn:hover { background-color: #c9302c; }
        #next-btn, #restart-btn { background-color: #007bff; }
        #next-btn:hover, #restart-btn:hover { background-color: #0069d9; }
        #results h2 { color: #28a745; }

        /* --- 印刷用スタイル --- */
        #printable-area {
            display: none;
            font-family: 'Hiragino Mincho ProN', 'MS Mincho', serif;
            color: #000;
        }
        .print-page {
            width: 100%;
            height: 100%;
            page-break-after: always;
        }
        .print-page:last-child {
            page-break-after: auto;
        }
        .print-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-end;
            border-bottom: 2px solid black;
            padding-bottom: 10px;
        }
        .print-header h2 {
            margin: 0;
            font-size: 16pt;
        }
        .print-info-table {
            border-collapse: collapse;
            border: 2px solid black;
            font-size: 10pt;
            width: 100%;
            margin-top: 10px;
        }
        .print-info-table td {
            border: 1px solid black;
            padding: 2px 8px;
            height: 25px;
        }
        .print-info-table td.label {
            background-color: #f2f2f2;
            text-align: center;
            white-space: nowrap;
        }
        .print-info-table td.value-name {
            width: 40%;
        }
        .print-main-content {
            margin-top: 10px;
        }
        .print-question-block {
            margin-top: 12px;
            font-size: 9.5pt;
        }
        .print-question-block p {
            margin: 0;
            margin-bottom: 2px;
        }
        .print-options {
            list-style-type: none;
            padding-left: 15px;
            display: flex;
            flex-wrap: wrap;
        }
        .print-options li {
            width: 50%;
            margin-bottom: 1px;
        }
        .answer-box {
            font-weight: bold;
            margin-left: 20px;
        }
        #print-answers h3 {
             border-bottom: 1px solid #000;
             padding-bottom: 5px;
             text-align: center;
        }
        #print-answers ol {
            font-size: 12pt;
        }

        @page {
            size: B5;
            margin: 15mm;
        }
        @media print {
            body > *:not(#printable-area) {
                display: none;
            }
            #printable-area {
                display: block;
            }
        }
    </style>
</head>
<body>

<div class="container">
    <div id="setup">
        <div id="setup-header">
            <h1 class="school-name">KOKOKU HIGH SCHOOL</h1>
            <p>ITビジネス科オリジナル</p>
        </div>
        <h1>全商情報処理検定<br>小テストジェネレーター</h1>
        <h2>設定</h2>
        <p>部門と級を選択してください。</p>
        <select id="department">
            <option value="business">ビジネス情報部門</option>
            <option value="programming">プログラミング部門</option>
        </select>
        <select id="level">
            </select>
        <div>
            <button id="start-btn">学習モード開始</button>
            <button id="pdf-btn">B5サイズでPDF出力</button>
        </div>
    </div>

    <div id="quiz" style="display:none;">
        <h2 id="question-counter"></h2>
        <div id="question"></div>
        <div id="options-container"></div>
        <div id="hint-container">
            <button id="hint-btn">ヒントを見る</button>
            <div id="hint-text"></div>
        </div>
        <div id="explanation" class="feedback" style="display:none;"></div>
        <button id="next-btn" style="display:none;">次の問題へ</button>
    </div>

    <div id="results" style="display:none;">
        <h2>テスト結果</h2>
        <p id="score" style="font-size: 1.5em; font-weight: bold;"></p>
        <p id="feedback-message"></p>
        <button id="restart-btn">もう一度挑戦する</button>
    </div>
</div>

<div id="printable-area"></div>

<script>
    // PDFの全範囲を元に作成した問題データベース
    const quizDatabase = [
        // 3級 ビジネス情報
        { department: 'business', level: 3, question: 'コンピュータを動作させるための基本的なソフトウェアは？', options: ['OS', 'アプリケーションソフトウェア', 'ウェアラブルコンピュータ', 'ユビキタス'], answer: 'OS', hint: 'Operating Systemの略です。', explanation: 'OSはコンピュータの基本的な管理や制御を行い、アプリケーションソフトウェアを動作させるための土台となります。' },
        { department: 'business', level: 3, question: 'ワープロソフトや表計算ソフトなど、特定の目的のために作られたソフトウェアは？', options: ['アプリケーションソフトウェア', 'OS', 'IoT', 'SNS'], answer: 'アプリケーションソフトウェア', hint: '「応用」ソフトウェアとも言います。', explanation: 'アプリケーションソフトウェアは、利用者が特定の作業を行うために使用するソフトウェアです。' },
        { department: 'business', level: 3, question: 'インターネット上のWebページやファイルの住所にあたるものは？', options: ['URL', 'IPアドレス', 'ドメイン名', 'プロトコル'], answer: 'URL', hint: 'Uniform Resource Locatorの略です。', explanation: 'URLは「https://...」のような形式で、インターネット上の情報の場所を指し示します。' },
        { department: 'business', level: 3, question: 'Webページを閲覧するためのソフトウェアは？', options: ['Webブラウザ', 'Webサーバ', '検索エンジン', '電子メール'], answer: 'Webブラウザ', hint: 'Google ChromeやMicrosoft Edgeなどがあります。', explanation: 'Webブラウザは、Webサーバから送られてくる情報を解釈し、人間が見やすい形で表示するソフトウェアです。' },
        { department: 'business', level: 3, question: '思想または感情を創作的に表現したものを保護する法律は？', options: ['著作権法', '個人情報保護法', '不正アクセス禁止法', 'プロバイダ責任制限法'], answer: '著作権法', hint: '音楽や小説、イラストなどが対象です。', explanation: '著作権法は、著作者の権利を守り、文化の発展を目的とする法律です。' },
        { department: 'business', level: 3, question: '生存する個人に関する情報で、特定の個人を識別できるものを保護する法律は？', options: ['個人情報保護法', '著作権法', 'サイバーセキュリティ基本法', '特定商取引法'], answer: '個人情報保護法', hint: '氏名や生年月日などがこれにあたります。', explanation: '個人情報保護法は、個人の権利利益を保護することを目的として、個人情報の適正な取扱いについて定めています。' },
        { department: 'business', level: 3, question: 'コンピュータの五大機能に含まれないものはどれ？', options: ['記憶', '入力', '出力', '通信'], answer: '通信', hint: 'コンピュータの基本的な働きを5つに分類したものです。', explanation: 'コンピュータの五大機能は「入力」「出力」「記憶」「制御」「演算」です。' },
        { department: 'business', level: 3, question: 'コンピュータ本体を構成する電子回路や周辺機器などの物理的な実体の総称は？', options: ['ハードウェア', 'ソフトウェア', 'ファームウェア', 'シェアウェア'], answer: 'ハードウェア', hint: '手で触れる「固い(Hard)」ものです。', explanation: 'ハードウェアは、コンピュータシステムを構成する物理的な機器全般を指します。' },
        { department: 'business', level: 3, question: 'コンピュータを制御するためのプログラムや命令の総称は？', options: ['ソフトウェア', 'ハードウェア', 'ヒューマンウェア', 'ミドルウェア'], answer: 'ソフトウェア', hint: '手で触れない「柔らかい(Soft)」ものです。', explanation: 'ソフトウェアには、OSのような基本ソフトウェアと、ワープロソフトなどの応用ソフトウェアがあります。' },
        { department: 'business', level: 3, question: '「いつでも、どこでも、誰でも」コンピュータネットワークが利用できる環境のことを何というか？', options: ['ユビキタス', 'IoT', 'AI', 'クラウド'], answer: 'ユビキタス', hint: 'ラテン語で「至る所に存在する」という意味です。', explanation: 'ユビキタス社会とは、あらゆる場所にコンピュータが存在し、いつでもネットワークを利用できる社会のことです。' },
        { department: 'business', level: 3, question: '身につけて持ち歩くことができるコンピュータを何というか？', options: ['ウェアラブルコンピュータ', 'パーソナルコンピュータ', 'サーバ', 'スマートフォン'], answer: 'ウェアラブルコンピュータ', hint: '「着用できる（Wearable）」コンピュータです。', explanation: 'スマートウォッチやスマートグラスなどがウェアラブルコンピュータの例です。' },

        // 2級 ビジネス情報
        { department: 'business', level: 2, question: '企業の販売活動を効率化し支援するための情報システムは？', options: ['SFA', 'CRM', 'SCM', 'ERP'], answer: 'SFA', hint: 'Sales Force Automationの略です。', explanation: 'SFAは営業支援システムとも呼ばれ、営業担当者の業務を自動化・効率化し、売上向上を支援します。' },
        { department: 'business', level: 2, question: '災害などが発生した際に、重要な業務を中断させないための事業継続計画を何というか？', options: ['BCP', 'BCM', 'リスクアセスメント', 'DR'], answer: 'BCP', hint: 'Business Continuity Planの略です。', explanation: 'BCPは、企業が自然災害やテロなどの緊急事態に遭遇した場合でも、事業資産の損害を最小限にとどめ、事業の継続あるいは早期復旧を可能とするために策定されます。' },
        { department: 'business', level: 2, question: '関係データベースにおいて、行（レコード）を一位に識別するための列（フィールド）は？', options: ['主キー', '外部キー', '候補キー', 'スーパーキー'], answer: '主キー', hint: 'プライマリキーとも呼ばれます。', explanation: '主キーを設定することで、データの重複を防ぎ、高速な検索が可能になります。' },
        { department: 'business', level: 2, question: 'LANとLANなどを接続し、ネットワーク間のデータの中継を行う通信機器は？', options: ['ルータ', 'ハブ', 'リピータ', 'モデム'], answer: 'ルータ', hint: '最適な経路(Route)を選択する機能があります。', explanation: 'ルータは、異なるネットワーク間でデータをやり取りする際の交通整理役を果たします。' },
        { department: 'business', level: 2, question: '文字や画像など、形式の異なるデータを電子メールで扱うための規格は？', options: ['MIME', 'SMTP', 'POP', 'IMAP'], answer: 'MIME', hint: 'Multipurpose Internet Mail Extensionsの略です。', explanation: 'MIMEにより、日本語のテキストや画像ファイルなどを電子メールに添付して送受信できます。' },
        { department: 'business', level: 2, question: 'データの暗号化と復号に異なる鍵（公開鍵と秘密鍵）を使用する暗号方式は？', options: ['公開鍵暗号方式', '共通鍵暗号方式', 'ハッシュ関数', 'デジタル署名'], answer: '公開鍵暗号方式', hint: '片方の鍵を一般に「公開」するのが特徴です。', explanation: '公開鍵暗号方式は、安全な通信路がなくても安全に鍵交換ができるという利点があります。' },
        { department: 'business', level: 2, question: '顧客との関係を管理し、長期的な収益向上を目指す経営手法・システムは？', options: ['CRM', 'ERP', 'SFA', 'SCM'], answer: 'CRM', hint: 'Customer Relationship Managementの略です。', explanation: 'CRMは、顧客満足度を向上させ、顧客ロイヤルティを高めることを目的としています。' },
        { department: 'business', level: 2, question: '原材料の調達から生産、販売に至るまでの一連の流れを統合的に管理する手法は？', options: ['SCM', 'POS', 'BI', 'CRM'], answer: 'SCM', hint: 'Supply Chain Managementの略です。', explanation: 'SCMは、情報の共有により、在庫の最適化や納期の短縮などを目指します。' },
        { department: 'business', level: 2, question: 'システム開発において、データの処理方法やプログラムの処理内容を設計する工程で、外部設計の後の工程は？', options: ['内部設計', '外部設計', '要件定義', 'システムテスト'], answer: '内部設計', hint: '開発者側の視点で行う設計です。', explanation: '内部設計は、外部設計で決定された機能をプログラムにするために、必要とされる処理手順(アルゴリズム)などを詳細に設計する開発工程です。' },
        { department: 'business', level: 2, question: 'LANケーブルを用いて各機器を接続するための集線装置は？', options: ['ハブ', 'ルータ', 'ゲートウェイ', 'モデム'], answer: 'ハブ', hint: '車輪の中心(hub)のように、ケーブルが集まります。', explanation: 'ハブは、LANにおけるネットワークケーブルを一つに接続する(まとめる)集線装置のことです。' },
        { department: 'business', level: 2, question: 'ネットワークを介してファイルを転送するためのプロトコルは？', options: ['FTP', 'HTTP', 'SMTP', 'POP'], answer: 'FTP', hint: 'File Transfer Protocolの略です。', explanation: 'FTPは、Webページの更新や、ファイルのダウンロードなどを行う際に用いられるプロトコルです。' },
        { department: 'business', level: 2, question: 'Webサイトを閲覧したブラウザ側の端末に、閲覧日時などの情報がファイルとして一時的に保存されるしくみは？', options: ['Cookie', 'MIME', 'ASP', 'NAT'], answer: 'Cookie', hint: 'お菓子のクッキーが由来の一つとされています。', explanation: 'Cookieにより、Webサイト側は訪問者の情報を記録し、ログイン状態の維持や広告表示の最適化などに利用します。' },
        { department: 'business', level: 2, question: 'データベースから目的のデータを抽出したり、更新したりするための言語は？', options: ['SQL', 'HTML', 'Java', 'Python'], answer: 'SQL', hint: 'Structured Query Languageの略です。', explanation: 'SQLは、リレーショナルデータベースの操作に広く用いられる国際標準の言語です。' },

        // 1級 ビジネス情報
        { department: 'business', level: 1, question: '要件定義からテストまで、工程を分割して進める開発モデルで、原則として前の工程に戻らない手法は？', options: ['ウォータフォールモデル', 'プロトタイピングモデル', 'スパイラルモデル', 'アジャイルモデル'], answer: 'ウォータフォールモデル', hint: '滝が流れ落ちる様子に例えられています。', explanation: 'ウォータフォールモデルは、比較的大規模な開発に向いている伝統的な開発手法です。' },
        { department: 'business', level: 1, question: '開発の初期段階で試作品を作成し、ユーザの評価をもとにシステムを開発する手法は？', options: ['プロトタイピングモデル', 'ウォータフォールモデル', 'スパイラルモデル', 'RAD'], answer: 'プロトタイピングモデル', hint: '「試作品」を英語で何と言うか考えてみましょう。', explanation: 'プロトタイピングモデルは、ユーザの要求を早期に具体化し、認識のズレを防ぐのに有効な開発モデルです。' },
        { department: 'business', level: 1, question: 'システムを独立性の高い部分ごとに分割し、設計・プログラミング・テストの工程を繰り返して開発する手法は？', options: ['スパイラルモデル', 'ウォータフォールモデル', 'プロトタイピングモデル', 'エクストリームプログラミング'], answer: 'スパイラルモデル', hint: '螺旋階段のように、同じ工程を繰り返しながら開発を進めていくイメージです。', explanation: 'スパイラルモデルは、ユーザの要求の変更に柔軟に対応しやすい開発モデルです。' },
        { department: 'business', level: 1, question: '開発したシステム全体が、設計どおりの機能を備えているかを確認する開発者側の最終テストは？', options: ['システムテスト', '単体テスト', '結合テスト', '受け入れテスト'], answer: 'システムテスト', hint: '「総合テスト」とも呼ばれます。', explanation: 'システムテストは、開発したシステム全体が要求された機能や性能を満たしているかを確認する、開発者側が行う最終テストです。' },
        { department: 'business', level: 1, question: 'プログラムの内部構造には着目せず、データ入力に対する出力結果に注目して実施するテストは？', options: ['ブラックボックステスト', 'ホワイトボックステスト', '単体テスト', '結合テスト'], answer: 'ブラックボックステスト', hint: 'プログラムの内部が「黒い箱」で見えない状態を想定したテストです。', explanation: 'ブラックボックステストは、入力したデータに対して仕様書どおりの出力が得られるかを確認するテストです。' },
        { department: 'business', level: 1, question: 'コンピュータシステムに関する評価指標であるRASISの「A」が示すものは？', options: ['可用性', '信頼性', '保守性', '安全性'], answer: '可用性', hint: '英語ではAvailabilityと書きます。', explanation: '可用性(Availability)は、一定期間にシステムが正常に使える時間の割合が長いことを示します。' },
        { department: 'business', level: 1, question: 'コンピュータシステムが故障してから、完全に復旧するまでの平均時間は？', options: ['平均修復時間(MTTR)', '平均故障間隔(MTBF)', 'ターンアラウンドタイム', 'レスポンスタイム'], answer: '平均修復時間(MTTR)', hint: 'Repair(修復)にかかる時間です。', explanation: '平均修復時間(MTTR: Mean Time To Repair)は、値が小さいほど保守性が高いことを示します。' },
        { department: 'business', level: 1, question: '障害が発生した場合でも、被害や障害を最小限に止め、安全性を保つしくみは？', options: ['フェールセーフ', 'フェールソフト', 'フォールトトレラント', 'フールプルーフ'], answer: 'フェールセーフ', hint: '失敗(Fail)しても安全(Safe)な状態を保つ、という意味です。', explanation: 'フェールセーフは、障害が発生した場合でも、被害や障害を最小限におさえて安全性が保てるようにするしくみです。' },
        { department: 'business', level: 1, question: '誤った操作をしてもシステムの安全性と信頼性を保つしくみは？', options: ['フールプルーフ', 'フェールセーフ', 'フェールソフト', 'フォールトトレラント'], answer: 'フールプルーフ', hint: '愚かな(Fool)操作をしても防ぐ(Proof)という意味です。', explanation: 'フールプルーフは、ユーザが操作を誤ってもシステムの安全性と信頼性を保持するしくみです。' },
        { department: 'business', level: 1, question: '複数のハードディスクに同じデータを書き込むことで信頼性を向上させるRAIDの方式は？', options: ['ミラーリング', 'ストライピング', 'RAID5', 'RAID6'], answer: 'ミラーリング', hint: '鏡(Mirror)のように同じデータを複製します。', explanation: 'ミラーリングはRAID1に相当し、1台のHDDに障害が起きてもシステムの稼働が可能となるため信頼性が向上します。' },
        { department: 'business', level: 1, question: '異なるネットワーク間を接続し、パケットの経路選択機能などを持つ装置は？', options: ['ルータ', 'ハブ', 'ゲートウェイ', 'リピータ'], answer: 'ルータ', hint: '最適な道順(Route)を決める役割を持ちます。', explanation: 'ルータは、IPアドレスをもとにデータの行き先を認識して転送し、最適な経路を選択する機能を持つ装置です。' },
        { department: 'business', level: 1, question: 'WebサーバとWebブラウザ間でHTML文書などを送受信するための通信規約は？', options: ['HTTP', 'FTP', 'SMTP', 'POP'], answer: 'HTTP', hint: 'URLの先頭によく使われる文字列です。', explanation: 'HTTP (HyperText Transfer Protocol) は、WebサーバとWebブラウザがデータをやり取りする際のルールを定めたものです。' },
        { department: 'business', level: 1, question: 'メールサーバから電子メールを受信するために用いる通信規約は？', options: ['POP', 'SMTP', 'IMAP', 'FTP'], answer: 'POP', hint: '郵便局(Post Office)から手紙を受け取るイメージです。', explanation: 'POP (Post Office Protocol) は、メールサーバのメールボックスから利用者のコンピュータへメールをダウンロードするためのプロトコルです。' },
        { department: 'business', level: 1, question: 'TCP/IPネットワーク上でコンピュータを識別するための番号は？', options: ['IPアドレス', 'MACアドレス', 'ポート番号', 'ドメイン名'], answer: 'IPアドレス', hint: 'インターネット上の住所とも言われます。', explanation: 'IPアドレスは、TCP/IPプロトコルを用いたネットワーク上で、個々のコンピュータを識別するために割り当てられる一意の番号です。' },
        { department: 'business', level: 1, question: 'インターネットのグローバルIPアドレスとプライベートIPアドレスを相互に変換する技術は？', options: ['NAT', 'DNS', 'DHCP', 'VPN'], answer: 'NAT', hint: 'Network Address Translationの略です。', explanation: 'NATは、LAN内の複数のコンピュータが、一つのグローバルIPアドレスを共有してインターネットに接続することを可能にする技術です。' },
        { department: 'business', level: 1, question: 'インターネットなどの外部ネットワークと内部ネットワークから隔離された区域（セグメント）のことは？', options: ['DMZ', 'VPN', 'LAN', 'WAN'], answer: 'DMZ', hint: '「非武装地帯」を意味する言葉の略です。', explanation: 'DMZ (DeMilitarized Zone) にWebサーバなどを設置することで、外部からの不正アクセスから内部ネットワークを保護します。' },
        { department: 'business', level: 1, question: 'ドメイン名とIPアドレスを互いに変換するためのしくみは？', options: ['DNS', 'DHCP', 'NAT', 'HTTP'], answer: 'DNS', hint: 'Domain Name Systemの略です。', explanation: 'DNSのおかげで、人間は数字の羅列であるIPアドレスの代わりに、分かりやすいドメイン名でWebサイトにアクセスできます。' },
        { department: 'business', level: 1, question: 'データの暗号化と復号に、異なる鍵（公開鍵と秘密鍵）を使用する暗号方式は？', options: ['公開鍵暗号方式', '共通鍵暗号方式', 'ハイブリッド暗号方式', '電子署名'], answer: '公開鍵暗号方式', hint: '片方の鍵を一般に「公開」するのが特徴です。', explanation: '公開鍵暗号方式は、暗号化には公開鍵、復号には秘密鍵という異なる鍵のペアを使用する暗号方式です。' },
        { department: 'business', level: 1, question: 'Webサーバとブラウザ間の通信を暗号化し、安全に送受信するための技術で、URLが「https://」で始まるものは？', options: ['SSL/TLS', 'FTP', 'HTTP', 'DNS'], answer: 'SSL/TLS', hint: 'Secure Socket Layer / Transport Layer Security の略です。', explanation: 'SSL/TLSは、オンラインショッピングなどでやり取りする個人情報などを暗号化し、インターネット上で安全に送受信するための技術です。' },
        { department: 'business', level: 1, question: 'コンピュータの利用状況やデータ通信の状況を記録したファイルは？', options: ['ログファイル', 'クッキー', 'キャッシュ', 'インデックス'], answer: 'ログファイル', hint: '航海日誌を意味する「logbook」が語源です。', explanation: 'ログファイルには、操作の日時や内容、送受信されたデータなどが記録され、トラブル発生時の原因調査などに利用されます。' },
        { department: 'business', level: 1, question: '心理的な隙や行動のミスにつけ込み、情報通信技術を使わずに情報を不正に収集する手口の総称は？', options: ['ソーシャルエンジニアリング', 'SQLインジェクション', 'クロスサイトスクリプティング', 'フィッシング詐欺'], answer: 'ソーシャルエンジニアリング', hint: '「社会的（ソーシャル）」な人の弱みを利用する「工学（エンジニアリング）」です。', explanation: 'ソーシャルエンジニアリングには、電話でパスワードを聞き出すなりすましや、肩越しにパスワードを盗み見るショルダーハックなどがあります。' },
        { department: 'business', level: 1, question: 'データベースと連携したWebアプリの脆弱性を利用して、不正なSQL文を実行させる攻撃は？', options: ['SQLインジェクション', 'クロスサイトスクリプティング', 'ソーシャルエンジニアリング', 'DoS攻撃'], answer: 'SQLインジェクション', hint: 'SQL文を「注入（インジェクション）」する攻撃です。', explanation: 'SQLインジェクション攻撃により、データベースの内容を不正に閲覧されたり、改ざん・削除されたりする危険性があります。' },
        { department: 'business', level: 1, question: '「批判禁止」「自由奔放」「質より量」「結合便乗」の4原則で行われるアイディア発想法は？', options: ['ブレーンストーミング', 'KJ法', 'SWOT分析', 'PPM分析'], answer: 'ブレーンストーミング', hint: '脳（Brain）に嵐（Storm）を巻き起こすようにアイディアを出し合います。', explanation: 'ブレーンストーミングは、新しいアイディアを引き出すことを目的に行われる話し合いの技法です。' },
        { department: 'business', level: 1, question: 'データの流れと処理の関係を、4つの記号（平行線、矢印、円、四角形）を用いて表す図は？', options: ['DFD', 'E-R図', 'パート図', 'フローチャート'], answer: 'DFD', hint: 'Data Flow Diagramの略です。', explanation: 'DFDは、システム開発において、業務のデータの流れを分析・設計するために用いられます。' },
        { department: 'business', level: 1, question: '作業の開始から終了までの所要日数が最長となる経路を何と呼びますか？', options: ['クリティカルパス', 'パート図', 'アローダイアグラム', '最短経路'], answer: 'クリティカルパス', hint: 'この経路の遅れは、プロジェクト全体の遅れに直結する「致命的な（クリティカルな）」道筋です。', explanation: 'クリティカルパスはパート図において、全体のスケジュールに影響を与える最も重要な作業経路を指します。' },
        { department: 'business', level: 1, question: '在庫管理などで用いられ、商品を重要度に応じてA・B・Cの3グループに分けて分析する方法は？', options: ['ABC分析', 'SWOT分析', 'PPM分析', '回帰分析'], answer: 'ABC分析', hint: 'アルファベットの最初の3文字が名前になっています。', explanation: 'ABC分析は、売上高や販売数量などから商品をランク付けし、重点的に管理すべき商品を明らかにするための手法です。' },
        { department: 'business', level: 1, question: '企業の「強み・弱み・機会・脅威」の4要素に整理して市場環境を分析する手法は？', options: ['SWOT分析', 'PPM分析', 'ABC分析', '3C分析'], answer: 'SWOT分析', hint: '4つの要素の英語の頭文字をとった名称です。', explanation: 'SWOT分析は、Strength(強み)、Weakness(弱み)、Opportunity(機会)、Threat(脅威)の4つの観点から、企業の現状を分析し、今後の戦略を立てるために用いられます。' },
        { department: 'business', level: 1, question: '自社の製品や事業を「市場成長率」と「市場占有率」から分析し、経営資源の配分を決定する手法は？', options: ['PPM分析', 'SWOT分析', 'ABC分析', 'ファイブフォース分析'], answer: 'PPM分析', hint: '製品を「花形」「金のなる木」「問題児」「負け犬」に分類します。', explanation: 'PPM分析 (Product Portfolio Management) は、多角的な事業を行う企業が、戦略的に経営資源を配分するために用いる手法です。' },
        { department: 'business', level: 1, question: '企業の経営資源を一元的に管理・有効活用し、業務の効率化を図るための経営手法は？', options: ['ERP', 'CRM', 'BPR', 'SCM'], answer: 'ERP', hint: 'Enterprise Resource Planningの略です。', explanation: 'ERP (経営資源計画) は、経理・生産・販売・人事などの基幹業務を統合的に管理し、経営全体の最適化を目指します。' },
        { department: 'business', level: 1, question: 'データベースにおいて、あるデータを処理しているとき、他からの更新などを制限してデータの整合性を保つしくみは？', options: ['排他制御', '共有ロック', 'デッドロック', 'トランザクション'], answer: '排他制御', hint: '他の処理を「排除」してデータを「制御」します。', explanation: '排他制御は、複数のトランザクションが同じデータに同時にアクセスした場合に、データの矛盾が生じないようにするための重要な機能です。' },
        { department: 'business', level: 1, question: '排他制御を行った複数の処理が互いにロック解除待ちとなり、処理が進まなくなる状態は？', options: ['デッドロック', 'コミット', 'ロールバック', '専有ロック'], answer: 'デッドロック', hint: '「膠着状態」とも言います。', explanation: 'デッドロックは、複数の処理がお互いの処理が終わるのを待ち続け、永久に処理が進まなくなってしまう状態です。' },
        { department: 'business', level: 1, question: '一連の更新処理の途中で問題が発生した場合、処理開始時点の状態にデータを戻すことは？', options: ['ロールバック', 'ロールフォワード', 'コミット', 'チェックポイント'], answer: 'ロールバック', hint: '処理を「後方へ転がす(Roll Back)」イメージです。', explanation: 'ロールバックは、ジャーナルファイルを用いてトランザクション処理開始時点の状態に戻し、データの整合性を保つ処理です。' },
        { department: 'business', level: 1, question: 'データベース設計の初期段階で、業務内容を分析し、E-R図を作成する工程は？', options: ['概念設計', '論理設計', '物理設計', '実装'], answer: '概念設計', hint: 'システムの「コンセプト」を決める最初の段階です。', explanation: '概念設計は、データベースで何をどのように管理するかを大まかに定義する、データベース設計の最も上流の工程です。' },
        { department: 'business', level: 1, question: 'E-R図において、一単位として扱われるデータのまとまりや対象物のことを何と呼びますか？', options: ['エンティティ', 'アトリビュート', 'リレーションシップ', 'カーディナリティ'], answer: 'エンティティ', hint: '日本語では「実体」と訳されます。', explanation: 'エンティティは、データベースとして表現すべき対象物のことで、論理設計の段階ではテーブルに相当します。' },
        { department: 'business', level: 1, question: '「法令遵守」を意味し、企業が法律や条例、社会規範などを守って活動することは？', options: ['コンプライアンス', 'アライアンス', 'アウトソーシング', 'コアコンピタンス'], answer: 'コンプライアンス', hint: '近年、企業の社会的責任として非常に重要視されています。', explanation: 'コンプライアンスは、単に法律を守るだけでなく、企業倫理や社会貢献などを含めた広い意味で使われます。' },
        { department: 'business', level: 1, question: '自社の業務の一部を、外部の専門業者に委託することは？', options: ['アウトソーシング', 'ハウジングサービス', 'ホスティングサービス', 'アライアンス'], answer: 'アウトソーシング', hint: '「外部（アウト）から資源（ソーシング）を調達する」という意味です。', explanation: 'アウトソーシングにより、企業は自社のコア業務に経営資源を集中させることができます。' },
        { department: 'business', level: 1, question: 'インターネット経由で、アプリケーションソフトが稼働するためのプラットフォーム環境を提供するサービスは？', options: ['PaaS', 'SaaS', 'IaaS', 'ASP'], answer: 'PaaS', hint: 'Platform as a Service の略です。', explanation: 'PaaSを利用することで、開発者はOSやミドルウェアの管理を気にすることなく、アプリケーション開発に専念できます。' },
        
        // 2級 プログラミング
        { department: 'programming', level: 2, question: 'プログラムの中でデータを一時的に記憶するために、名前を付けた領域のことを何というか。', options: ['変数', '定数', '配列', '関数'], answer: '変数', hint: '中に入れる値が変化することからこの名前がついています。', explanation: '変数は、数値や文字列などのデータを入れておくための箱のようなものです。' },
        { department: 'programming', level: 2, question: 'プログラムの処理の流れを、記号を用いて視覚的に表現した図を何というか。', options: ['フローチャート', 'E-R図', 'DFD', 'UML'], answer: 'フローチャート', hint: '「流れ図」とも呼ばれます。', explanation: 'フローチャートを使うことで、プログラムのアルゴリズム（処理手順）を分かりやすく整理できます。' },
        { department: 'programming', level: 2, question: '特定の処理をひとまとめにし、名前を付けて何度も呼び出せるようにしたものを何というか。', options: ['関数', '変数', '引数', '戻り値'], answer: '関数', hint: '数学のf(x)のように、何かを入れると決まった処理をして結果を返します。', explanation: '関数を使うことで、同じコードを何度も書く手間が省け、プログラムが構造化されて分かりやすくなります。' },
        { department: 'programming', level: 2, question: 'プログラムの誤りや不具合のことを、虫に例えて何と呼ぶか。', options: ['バグ', 'ウイルス', 'クラッシュ', 'エラー'], answer: 'バグ', hint: 'この虫を取り除く作業をデバッグと言います。', explanation: 'プログラムが設計者の意図通りに動かない原因となる誤りのことをバグと呼びます。' },
        { department: 'programming', level: 2, question: '関数を呼び出す際に、その関数に渡す値のことを何というか。', options: ['引数', '戻り値', '変数', '仮引数'], answer: '引数', hint: '「ひきすう」と読みます。関数に情報を引き渡す値です。', explanation: '引数を使うことで、関数は様々なデータに対して同じ処理を行うことができ、汎用性が高まります。' },
        { department: 'programming', level: 2, question: '関数が処理を終えた後、呼び出し元に返す値のことを何というか。', options: ['戻り値', '引数', '変数', 'スコープ'], answer: '戻り値', hint: '「かえりち」とも読みます。', explanation: '戻り値によって、関数の実行結果を他の処理で利用することができます。' },
        { department: 'programming', level: 2, question: '同じ種類のデータを複数個、連続した領域に格納するためのデータ構造は？', options: ['配列', '変数', '構造体', 'リスト'], answer: '配列', hint: 'インデックス（添字）を使って各要素にアクセスします。', explanation: '配列を使うことで、多くのデータを効率的に管理できます。' },
        { department: 'programming', level: 2, question: 'コンピュータに与える処理手順を、順序立てて記述したものを何というか。', options: ['アルゴリズム', 'プログラム', 'ソースコード', 'フローチャート'], answer: 'アルゴリズム', hint: '「算法」とも訳されます。', explanation: 'アルゴリズムは、特定の問題を解決するための計算手順や処理手順の集まりです。' },
        { department: 'programming', level: 2, question: 'プログラムの誤りを見つけ出し、修正する作業を何というか。', options: ['デバッグ', 'コンパイル', 'コーディング', 'テスト'], answer: 'デバッグ', hint: 'バグ（虫）を取り除く(de)作業です。', explanation: 'デバッグは、プログラムが意図通りに動作しない原因（バグ）を特定し、取り除くための重要な工程です。' },
        { department: 'programming', level: 2, question: 'プログラムの基本的な三つの制御構造に含まれないものは？', options: ['順次', '選択（分岐）', '繰り返し', '代入'], answer: '代入', hint: 'プログラムは基本的に上から下へ、条件によって分かれ、繰り返すことで成り立っています。', explanation: 'プログラムの基本制御構造は「順次」「選択（分岐）」「繰り返し」の３つです。代入は命令の一つですが、制御構造には分類されません。' },
        { department: 'programming', level: 2, question: 'プログラムの実行中に発生する、予期しないエラーを何というか。', options: ['実行時エラー', '構文エラー', '論理エラー', 'コンパイルエラー'], answer: '実行時エラー', hint: '「例外」とも呼ばれます。', explanation: 'ゼロ除算や存在しないファイルへのアクセスなど、プログラムを実行してみないと発見できないエラーです。' },

        // 1級 プログラミング
        { department: 'programming', level: 1, question: 'データとそれに対する手続きをひとまとめにした「オブジェクト」を基本単位としてプログラムを構成する考え方は？', options: ['オブジェクト指向', '構造化プログラミング', '手続き型プログラミング', '関数型プログラミング'], answer: 'オブジェクト指向', hint: '現実世界の「モノ」に例えて考えます。', explanation: 'オブジェクト指向は、カプセル化、継承、多様性などの特徴を持ち、大規模で複雑なソフトウェアの開発に適しています。' },
        { department: 'programming', level: 1, question: '人間が書いたソースコードを、コンピュータが実行できる機械語に一括して翻訳するソフトウェアは？', options: ['コンパイラ', 'インタプリタ', 'アセンブラ', 'デバッガ'], answer: 'コンパイラ', hint: '翻訳(compile)するもの、という意味です。', explanation: 'コンパイラはプログラム全体を一度に翻訳して実行ファイルを生成します。一方、一行ずつ翻訳しながら実行する方式をインタプリタと呼びます。' },
        { department: 'programming', level: 1, question: '既存のクラスの性質を受け継いで、新しいクラスを定義するオブジェクト指向のしくみは？', options: ['継承', 'カプセル化', 'ポリモーフィズム', 'インスタンス化'], answer: '継承', hint: '親から子へ性質が受け継がれる関係に似ています。', explanation: '継承（インヘリタンス）により、コードの再利用性が高まり、効率的な開発が可能になります。' },
        { department: 'programming', level: 1, question: '同じ名前のメソッドでも、引数の型や数が異なれば、別のメソッドとして定義できるしくみは？', options: ['オーバーロード', 'オーバーライド', 'カプセル化', '抽象化'], answer: 'オーバーロード', hint: 'メソッドの多重定義とも呼ばれます。', explanation: 'オーバーロードにより、似た機能を持つメソッドに同じ名前を付けることができ、プログラムの可読性が向上します。' },
        { department: 'programming', level: 1, question: '最初に入れたデータが最初に取り出される（FIFO）データ構造は？', options: ['キュー', 'スタック', 'リスト', 'ツリー'], answer: 'キュー', hint: '行列で順番待ちをするのと同じ原理です。', explanation: 'キューはFirst-In, First-Outのデータ構造です。一方、後入れ先出し（LIFO）のデータ構造をスタックと呼びます。' },
        { department: 'programming', level: 1, question: '後から入れたデータが最初に取り出される（LIFO）データ構造は？', options: ['スタック', 'キュー', 'ヒープ', 'ツリー'], answer: 'スタック', hint: '積み重ねた（Stack）本を取り出すイメージです。', explanation: 'スタックはLast-In, First-Outのデータ構造です。一方、先入れ先出し（FIFO）のデータ構造をキューと呼びます。' },
        { department: 'programming', level: 1, question: 'オブジェクトの内部構造を外部から隠蔽し、定められた手続きでのみ操作できるようにすることは？', options: ['カプセル化', '継承', '多様性', '抽象化'], answer: 'カプセル化', hint: '薬の「カプセル」のように中身を保護します。', explanation: 'カプセル化により、外部からの意図しないアクセスを防ぎ、オブジェクトの独立性と安全性を高めることができます。' },
        { department: 'programming', level: 1, question: '親クラスで定義されたメソッドを、子クラスで再定義（上書き）することは？', options: ['オーバーライド', 'オーバーロード', 'インスタンス化', 'カプセル化'], answer: 'オーバーライド', hint: '親の機能を乗り越えて（override）上書きするイメージです。', explanation: 'オーバーライドは、ポリモーフィズム（多様性）を実現するための重要な仕組みです。' },
        { department: 'programming', level: 1, question: '隣り合うデータを比較・交換しながら、全体のデータを整列させるアルゴリズムは？', options: ['バブルソート', 'クイックソート', 'マージソート', '選択ソート'], answer: 'バブルソート', hint: '泡（Bubble）が浮き上がるように、軽い（小さい）値が上に来るイメージです。', explanation: 'バブルソートはアルゴリズムが単純で理解しやすいですが、データ数が多いと処理速度が非常に遅くなる特徴があります。' },
        { department: 'programming', level: 1, question: 'ある関数の中から自分自身を呼び出すことで、繰り返し処理を実現する手法は？', options: ['再帰呼び出し', '継承', 'オーバーロード', 'カプセル化'], answer: '再帰呼び出し', hint: '終了条件を設けないと無限ループに陥ります。', explanation: '再帰呼び出しは、特定の種類の問題を簡潔に記述できる強力なプログラミング技法です。' },
        { department: 'programming', level: 1, question: 'あるクラス（設計図）を元にして、メモリ上に生成された実体のことを何というか？', options: ['インスタンス', 'メソッド', 'プロパティ', 'コンストラクタ'], answer: 'インスタンス', hint: '「実体」とも訳されます。', explanation: '一つのクラスから複数のインスタンスを生成することができます。たい焼きの型がクラスで、焼かれたたい焼きがインスタンスに例えられます。' },
        { department: 'programming', level: 1, question: 'データの先頭から順番に目的のデータを探すアルゴリズムは？', options: ['線形探索法', '二分探索法', 'ハッシュ法', '木構造探索'], answer: '線形探索法', hint: '最も単純で基本的な探索方法です。', explanation: '線形探索法は、整列されていないデータに対しても使用できますが、データ数が多いと時間がかかるという欠点があります。' },
        { department: 'programming', level: 1, question: '整列済みのデータの中央値と比較し、探索範囲を半分に絞りながら目的のデータを見つけるアルゴリズムは？', options: ['二分探索法', '線形探索法', '全数探索法', 'ハッシュ法'], answer: '二分探索法', hint: '辞書で単語を探す方法に似ています。', explanation: '二分探索法は、線形探索法に比べて非常に高速ですが、データが予めソートされている必要があります。' }
    ];

    const levelOptions = {
        business: [
            { value: '3', text: '3級' },
            { value: '2', text: '2級' },
            { value: '1', text: '1級' }
        ],
        programming: [
            { value: '2', text: '2級' },
            { value: '1', text: '1級' }
        ]
    };

    let currentQuestions = [];
    let currentQuestionIndex = 0;
    let score = 0;

    const setupEl = document.getElementById('setup');
    const quizEl = document.getElementById('quiz');
    const resultsEl = document.getElementById('results');

    const startBtn = document.getElementById('start-btn');
    const pdfBtn = document.getElementById('pdf-btn');
    const nextBtn = document.getElementById('next-btn');
    const restartBtn = document.getElementById('restart-btn');
    
    const departmentSelect = document.getElementById('department');
    const levelSelect = document.getElementById('level');

    const questionCounterEl = document.getElementById('question-counter');
    const questionEl = document.getElementById('question');
    const optionsContainerEl = document.getElementById('options-container');
    const explanationEl = document.getElementById('explanation');
    const hintBtn = document.getElementById('hint-btn');
    const hintTextEl = document.getElementById('hint-text');
    const printableAreaEl = document.getElementById('printable-area');

    departmentSelect.addEventListener('change', updateLevelOptions);
    startBtn.addEventListener('click', startQuiz);
    pdfBtn.addEventListener('click', generatePdf);
    nextBtn.addEventListener('click', nextQuestion);
    restartBtn.addEventListener('click', () => {
        resultsEl.style.display = 'none';
        setupEl.style.display = 'block';
    });
    hintBtn.addEventListener('click', () => {
        hintTextEl.style.display = 'block';
    });

    function updateLevelOptions() {
        const selectedDepartment = departmentSelect.value;
        levelSelect.innerHTML = ''; 

        levelOptions[selectedDepartment].forEach(optionInfo => {
            const option = document.createElement('option');
            option.value = optionInfo.value;
            option.textContent = optionInfo.text;
            levelSelect.appendChild(option);
        });
    }

    function getSelectedQuizData() {
        const selectedDepartment = departmentSelect.value;
        const selectedLevel = parseInt(levelSelect.value);
        let availableQuestions = quizDatabase.filter(q => q.department === selectedDepartment && q.level === selectedLevel);
        
        if(availableQuestions.length === 0){
            alert('申し訳ありません。選択された条件に合う問題がありません。');
            return null;
        }
        availableQuestions = shuffleArray(availableQuestions);
        return availableQuestions.slice(0, 10);
    }

    function generatePdf() {
        const questionsForPdf = getSelectedQuizData();
        if (!questionsForPdf) return;

        const deptText = departmentSelect.options[departmentSelect.selectedIndex].text;
        const levelText = levelSelect.options[levelSelect.selectedIndex].text;
        const today = new Date();
        const dateString = `${today.getFullYear()} 年 ${today.getMonth() + 1} 月 ${today.getDate()} 日`;
        
        let testSheetHtml = `<div class="print-page">`;
        testSheetHtml += `
            <div class="print-header">
                <h2>全商情報処理検定 小テスト (${deptText} ${levelText})</h2>
            </div>
            <table class="print-info-table">
                <tr>
                    <td class="label">学年</td><td class="value"></td>
                    <td class="label">出席番号</td><td class="value"></td>
                    <td class="label">名前</td><td class="value value-name"></td>
                </tr>
                <tr>
                    <td class="label">日付</td><td class="value" colspan="2">${dateString}</td>
                    <td class="label">得点</td><td class="value" colspan="2"></td>
                </tr>
            </table>`;
        
        testSheetHtml += `<div class="print-main-content">`;
        let answersForSheet = {}; 
        const optionsLabels = ['ア', 'イ', 'ウ', 'エ'];

        questionsForPdf.forEach((q, index) => {
            testSheetHtml += `<div class="print-question-block">`;
            testSheetHtml += `<p><strong>第${index + 1}問.</strong> ${q.question}</p>`;
            testSheetHtml += `<ol class="print-options">`;
            
            // PDF出力時も選択肢をランダムにする場合はこのまま
            // 固定したい場合は、`shuffleArray`を削除
            const shuffledOptions = shuffleArray([...q.options]);
            
            shuffledOptions.forEach((opt, optIndex) => {
                const label = optionsLabels[optIndex];
                testSheetHtml += `<li>${label}. ${opt}</li>`;
                if (opt === q.answer) {
                    answersForSheet[index + 1] = { label: label, text: q.answer };
                }
            });
            testSheetHtml += `</ol>`;
            // 解答を書き込む欄を追加
            testSheetHtml += `<div class="answer-box">解答：(  )</div>`;
            testSheetHtml += `</div>`;
        });
        testSheetHtml += `</div>`;
        testSheetHtml += `</div>`;


        let answerKeyHtml = `<div class="print-page">`;
         answerKeyHtml += `
            <div class="print-header">
                <h2>全商情報処理検定 小テスト (${deptText} ${levelText}) - 解答</h2>
            </div>`;
        answerKeyHtml += `<div id="print-answers"><h3>解答</h3><ol>`;
        
        for (let i = 1; i <= 10; i++) {
             if (answersForSheet[i]) {
                answerKeyHtml += `<li>第${i}問: ${answersForSheet[i].label} (${answersForSheet[i].text})</li>`;
             }
        }
        answerKeyHtml += `</ol></div></div>`;

        printableAreaEl.innerHTML = testSheetHtml + answerKeyHtml;
        window.print();
    }


    function startQuiz() {
        currentQuestions = getSelectedQuizData();
        if(!currentQuestions) return;
        
        currentQuestionIndex = 0;
        score = 0;

        setupEl.style.display = 'none';
        resultsEl.style.display = 'none';
        quizEl.style.display = 'block';

        displayQuestion();
    }

    function displayQuestion() {
        resetState();
        const question = currentQuestions[currentQuestionIndex];
        questionCounterEl.textContent = `第 ${currentQuestionIndex + 1} 問 / ${currentQuestions.length} 問`;
        questionEl.innerHTML = question.question;
        hintTextEl.innerHTML = `ヒント: ${question.hint}`;
        
        const shuffledOptions = shuffleArray([...question.options]);

        shuffledOptions.forEach(option => {
            const button = document.createElement('button');
            button.innerText = option;
            button.classList.add('btn');
            button.addEventListener('click', selectAnswer);
            optionsContainerEl.appendChild(button);
        });
    }

    function resetState() {
        nextBtn.style.display = 'none';
        explanationEl.style.display = 'none';
        hintBtn.style.display = 'block';
        hintTextEl.style.display = 'none';
        while (optionsContainerEl.firstChild) {
            optionsContainerEl.removeChild(optionsContainerEl.firstChild);
        }
    }

    function selectAnswer(e) {
        const selectedBtn = e.target;
        const correct = selectedBtn.innerText === currentQuestions[currentQuestionIndex].answer;

        if (correct) {
            score++;
            selectedBtn.classList.add('correct');
            explanationEl.innerHTML = `<strong>正解！</strong><br>${currentQuestions[currentQuestionIndex].explanation}`;
        } else {
            selectedBtn.classList.add('incorrect');
            explanationEl.innerHTML = `<strong>不正解...</strong> 正解は「<strong>${currentQuestions[currentQuestionIndex].answer}</strong>」です。<hr style="border: 0; border-top: 1px solid #ccc; margin: 10px 0;">${currentQuestions[currentQuestionIndex].explanation}`;
        }

        Array.from(optionsContainerEl.children).forEach(button => {
            if (button.innerText === currentQuestions[currentQuestionIndex].answer) {
                if(!button.classList.contains('correct')) button.classList.add('correct');
            }
            button.disabled = true;
        });

        explanationEl.style.display = 'block';
        hintBtn.style.display = 'none';
        hintTextEl.style.display = 'none';

        if (currentQuestions.length > currentQuestionIndex + 1) {
            nextBtn.style.display = 'block';
        } else {
            setTimeout(showResults, 1200);
        }
    }

    function nextQuestion() {
        currentQuestionIndex++;
        displayQuestion();
    }
    
    function showResults(){
        quizEl.style.display = 'none';
        resultsEl.style.display = 'block';
        document.getElementById('score').textContent = `${currentQuestions.length} 問中 ${score} 問正解！`;
        
        let message = '';
        const percentage = score / currentQuestions.length;
        if(percentage === 1){
            message = '素晴らしい！全問正解です！この調子で合格を目指しましょう！';
        } else if (percentage >= 0.8){
            message = '高得点です！間違えた問題を復習すれば、合格は目前です。';
        } else if (percentage >= 0.5){
            message = 'よく頑張りました。解説をしっかり読んで、知識を定着させましょう。';
        } else {
            message = 'まだまだ伸びしろがありますね！諦めずに再挑戦しましょう。';
        }
        document.getElementById('feedback-message').textContent = message;
    }

    function shuffleArray(array) {
        for (let i = array.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [array[i], array[j]] = [array[j], array[i]];
        }
        return array;
    }
    
    document.addEventListener('DOMContentLoaded', updateLevelOptions);

</script>
</body>
</html>
